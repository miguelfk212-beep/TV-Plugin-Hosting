<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Analysis - TradingView</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: #1e1e1e;
        }
        
        #tradingview-widget-container {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <div id="tradingview-widget-container"></div>

    <script>
        // Simplified symbol map, including only Forex and Gold to avoid errors.
        const cTraderToTvMap = {
            // Forex
            'EURUSD': 'FX:EURUSD', 'GBPUSD': 'FX:GBPUSD', 'AUDUSD': 'FX:AUDUSD', 'NZDUSD': 'FX:NZDUSD',
            'USDJPY': 'FX:USDJPY', 'USDCHF': 'FX:USDCHF', 'USDCAD': 'FX:USDCAD',
            'EURGBP': 'FX:EURGBP', 'EURJPY': 'FX:EURJPY', 'EURCHF': 'FX:EURCHF',
            'EURAUD': 'FX:EURAUD', 'EURNZD': 'FX:EURNZD', 'EURCAD': 'FX:EURCAD',
            'GBPJPY': 'FX:GBPJPY', 'GBPCHF': 'FX:GBPCHF', 'GBPAUD': 'FX:GBPAUD',
            'GBPNZD': 'FX:GBPNZD', 'GBPCAD': 'FX:GBPCAD', 'AUDJPY': 'FX:AUDJPY',
            'AUDCHF': 'FX:AUDCHF', 'AUDNZD': 'FX:AUDNZD', 'AUDCAD': 'FX:AUDCAD',
            'NZDJPY': 'FX:NZDJPY', 'NZDCHF': 'FX:NZDCHF', 'NZDCAD': 'FX:NZDCAD',
            'CADJPY': 'FX:CADJPY', 'CADCHF': 'FX:CADCHF', 'CHFJPY': 'FX:CHFJPY',
            // Gold
            'GOLD': 'TVC:GOLD', 'XAUUSD': 'TVC:GOLD'
        };

        /**
         * Global function to update the widget. This is called by cTrader.
         * @param {string} cTraderSymbolName - The symbol from cTrader (e.g., "EURUSD").
         */
        function setSymbol(cTraderSymbolName) {
            console.log("Updating symbol to:", cTraderSymbolName);
            
            // Map the cTrader symbol to the TradingView symbol
            const tvSymbol = cTraderToTvMap[cTraderSymbolName] || cTraderSymbolName;
            
            const container = document.getElementById('tradingview-widget-container');
            container.innerHTML = '';
            
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.async = true;
            script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js';
            
            script.innerHTML = JSON.stringify({
                "width": "100%",
                "height": "100%",
                "isTransparent": false,
                "symbol": tvSymbol,
                "showIntervalTabs": true,
                "displayMode": "single",
                "locale": "en", // Changed to English as required
                "colorTheme": "dark"
            });
            
            container.appendChild(script);
        }
    </script>
</body>
</html>
