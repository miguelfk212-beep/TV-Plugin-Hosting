<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget de TradingView para cTrader</title>
    <style>
        /* Asegura que el widget ocupe toda la ventana sin márgenes */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden; /* Evita barras de desplazamiento no deseadas */
            background-color: #1e1e1e; /* Color de fondo que coincide con el tema oscuro */
        }
        
        /* El contenedor donde se inyectará el widget */
        #tradingview-widget-container {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <!-- Este div es el ancla donde TradingView creará su widget -->
    <div id="tradingview-widget-container"></div>

    <script>
        /**
         * Función GLOBAL para cambiar el símbolo del widget.
         * Esta función será llamada desde el plugin de cTrader usando InvokeScript.
         * @param {string} tradingViewTicker - El ticker final de TradingView (ej: "NASDAQ:NDX").
         */
        function setSymbol(tradingViewTicker) {
            // Log para depuración. Puedes verlo en la consola de desarrollador (F12) dentro de la ventana del plugin.
            console.log("Llamada a setSymbol con el ticker:", tradingViewTicker);

            // 1. Obtener el contenedor del widget.
            const container = document.getElementById('tradingview-widget-container');
            
            // 2. Limpiar el contenido anterior. Esto es CRUCIAL para recargar el widget.
            container.innerHTML = '';
            
            // 3. Crear un nuevo elemento <script> para el widget de TradingView.
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.async = true;
            script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js';
            
            // 4. Definir la configuración del widget con el nuevo símbolo.
            script.innerHTML = JSON.stringify({
                "interval": "1D", // Intervalo por defecto: 1 Día
                "width": "100%",
                "height": "100%",
                "isTransparent": false,
                "symbol": tradingViewTicker, // Usamos el ticker que nos pasaron
                "showIntervalTabs": true,
                "displayMode": "single", // Muestra un solo activo
                "locale": "es",
                "colorTheme": "dark"
            });
            
            // 5. Añadir el nuevo script al contenedor para que se cargue.
            container.appendChild(script);
        }

        /**
         * Función para inicializar el widget con un símbolo por defecto cuando la página se carga.
         */
        function initializeWidget() {
            // Puedes poner aquí un símbolo por defecto que te guste.
            setSymbol('INDEX:SPX');
        }

        // Ejecuta la función de inicialización cuando la página esté completamente cargada.
        window.onload = initializeWidget;

    </script>
</body>
</html>
